clear
close all
clc

data=readtable("C:\Users\manue\Desktop\Tire_test1.csv");

currentFile = mfilename('fullpath');
[pathstr, ~, ~] = fileparts(currentFile);
addpath(genpath(pathstr));


Tyre.Params_f = mfeval.readTIR(strcat(pathstr,"\file tir\FRONT_V1Pirelli_Cinturato_AR_Giulia_2.2_JTD_150_AT8_DC_LMUX_OK_LMUY_V1.tir"));
Tyre.Params_r = mfeval.readTIR(strcat(pathstr,"\file tir\REAR_V1Pirelli_Cinturato_AR_Giulia_2.2_JTD_150_AT8_DC_LMUX_OK_LMUY_V1.tir"));

time = data.time_TIME;

alfa = data.wheel_angles_toe;

Fz = data.til_wheel_tire_forces_normal;

n = numel(time);
kappa = zeros(n,1);
gamma = zeros(n,1);
phit = zeros (n,1);
Vx = ones (n,1)*90/3.6;

outMF_fl = mfeval(Tyre.Params_f , [Fz_fl Kappa_fl +alfa_fl -camber_fl phit Vx] , 111);
outMF_fr = mfeval(Tyre.Params_f , [Fz_fr Kappa_fr +alfa_fr +camber_fr phit Vx] , 111);
outMF_rl = mfeval(Tyre.Params_r , [Fz_rl Kappa_rl +alfa_rl -camber_rl phit Vx] , 111);
outMF_rr = mfeval(Tyre.Params_r , [Fz_rr Kappa_rr +alfa_rr +camber_rr phit Vx] , 111);

Fy_fl = -outMF_fl(:,2);
Fy_fr = -outMF_fr(:,2);
Fy_rl = -outMF_rl(:,2);
Fy_rr = -outMF_rr(:,2);

Fy_fl_data = data.Tire_Ground_Surface_Force_Y_L1;
Fy_fr_data = data.Tire_Ground_Surface_Force_Y_R1;
Fy_rl_data = data.Tire_Ground_Surface_Force_Y_L2;
Fy_rr_data = data.Tire_Ground_Surface_Force_Y_R2;

figure
hold on
set(gca,'TickLabelInterpreter','latex');
subtitle('Front left',Interpreter='latex',fontsize=14);
scatter3(-alfa_fl,Fz_fl,-Fy_fl,10,'filled');
scatter3(-alfa_fl,Fz_fl,Fy_fl_data,10,'filled');
xlabel('$\alpha [rad]$',Interpreter='latex',fontsize=16);
ylabel('$F_z [N]$',Interpreter='latex',fontsize=14);
zlabel('$F_y [N]$',Interpreter='latex',fontsize=14);
legend('$F_y (MFeval)$','$F_y (Data)$',Interpreter='latex',fontsize=16);

figure
hold on
set(gca,'TickLabelInterpreter','latex');
subtitle('Front right',Interpreter='latex',fontsize=14);
scatter3(-alfa_fr,Fz_fr,-Fy_fr,10,'filled');
scatter3(-alfa_fr,Fz_fr,Fy_fr_data,10,'filled');
xlabel('$\alpha [rad]$',Interpreter='latex',fontsize=16);
ylabel('$F_z [N]$',Interpreter='latex',fontsize=14);
zlabel('$F_y [N]$',Interpreter='latex',fontsize=14);
legend('$F_y (MFeval)$','$F_y (Data)$',Interpreter='latex',fontsize=16);

figure
hold on
set(gca,'TickLabelInterpreter','latex');
subtitle('Rear left',Interpreter='latex',fontsize=14);
scatter3(-alfa_rl,Fz_rl,-Fy_rl,10,'filled');
scatter3(-alfa_rl,Fz_rl,Fy_rl_data,10,'filled');
xlabel('$\alpha [rad]$',Interpreter='latex',fontsize=16);
ylabel('$F_z [N]$',Interpreter='latex',fontsize=14);
zlabel('$F_y [N]$',Interpreter='latex',fontsize=14);
legend('$F_y (MFeval)$','$F_y (Data)$',Interpreter='latex',fontsize=16);

figure
hold on
set(gca,'TickLabelInterpreter','latex');
subtitle('Rear right',Interpreter='latex',fontsize=14);
scatter3(-alfa_rr,Fz_rr,-Fy_rr,10,'filled');
scatter3(-alfa_rr,Fz_rr,Fy_rr_data,10,'filled');
xlabel('$\alpha [rad]$',Interpreter='latex',fontsize=16);
ylabel('$F_z [N]$',Interpreter='latex',fontsize=14);
zlabel('$F_y [N]$',Interpreter='latex',fontsize=14);
legend('$F_y (MFeval)$','$F_y (Data)$',Interpreter='latex',fontsize=16);



